"use strict";var _createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,o);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(a){DRTS.Location.field=function(e){function n(e){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));o.field.find(".drts-location-find-address").click(function(t){var r=[],e=o.field.closest(".drts-location-address-container");return e.length||(e=o.field),e.find(".drts-location-find-address-component").each(function(e,t){var o=a(t),n=void 0;if("select"===t.tagName.toLowerCase()){if(!o.val())return!0;n=a.trim(o.find("option:selected").text())}else n=a.trim(o.val());n.length&&r.push(n)}),r.length&&(DRTS.ajaxLoader(t.currentTarget),DRTS.Location.api.geocode(a.trim(r.join(" ")),function(e){DRTS.ajaxLoader(t.currentTarget,!0),console.log("Geocoding results:",e),o.setMarker(e).updateFields(e).updateTimezoneField(e),o.map.draw({zoom:o.map.getZoom()})},function(e){DRTS.ajaxLoader(t.currentTarget,!0),o._showApiError(e)})),!1}),o.field.find(".drts-location-get-address").click(function(){var e=o.map.getMarkerPosition();return e&&o.updateFields(e).updateAddressFields(e,!0).updateTimezoneField(e),!1});var t=o.field.find(".drts-location-text-input");return t.length&&DRTS.Location.api.autocomplete(t,function(e){console.log("Autocomplete results:",e),o.setMarker(e.latlng).updateFields(e.latlng).updateTimezoneField(e.latlng)._setAddressComponentValues(e,!0),o.map.draw({zoom:o.map.getZoom()})}),o}return _inherits(n,DRTS.Map.field),_createClass(n,[{key:"_onMapClicked",value:function(e){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_onMapClicked",this).call(this,e).updateAddressFields(e,!1).updateTimezoneField(e)}},{key:"_onLatLngFieldModified",value:function(e){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_onLatLngFieldModified",this).call(this,e).updateAddressFields(e,!1).updateTimezoneField(e)}},{key:"updateTimezoneField",value:function(e){var t=this,o=this.field.find(".drts-location-address-timezone select");return o.length&&DRTS.Location.api.getTimezone(e,function(e){console.log("Time zone: "+e),o.val(e)},function(e){t._showApiError(e),o.val("")}),this}},{key:"updateAddressFields",value:function(e,t){var o=this;return DRTS.Location.api.reverseGeocode(e,function(e){console.log("Reverse geocoding results:",e),o._setAddressComponentValues(e,t)},function(e){o._showApiError(e)}),this}},{key:"_showApiError",value:function(e){return console.log(e),DRTS.flash(e.message,"danger",1e4),this}},{key:"_setAddressComponentValues",value:function(e,t){var o=!0,n=!1,r=void 0;try{for(var i,a=["address","street","city","province","zip","country"][Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var l=i.value;this._setAddressComponentValue(".drts-location-address-"+l,e[l]||"",t,e)}}catch(e){n=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(n)throw r}}return this}},{key:"_setAddressComponentValue",value:function(e,n,r,i){return this.field.find(e).each(function(e,t){var o=a(t);(r||""===o.val()||"hidden"===o.attr("type"))&&(o.data("format")&&(n=(n=o.data("format").replace(/{(.*?)}/g,function(e,t){return t in i?i[t]:""})).replace(/\s+/g," ").trim().replace(/(^,)|(,$)/g,"").trim()),"select"===t.tagName.toLowerCase()?o.find("option").each(function(e,t){if(t.value===n||t.innerHTML===n)return o.val(t.value),!1}):o.val(n))}),this}}]),n}()}(jQuery);