"use strict";!function(y){DRTS.Location=DRTS.Location||{},DRTS.Location.textfield=DRTS.Location.textfield||function(t){var e=y(t);if(e.length){var o,s=e.find(".drts-location-text-input"),n=e.find(".drts-location-text-center"),i=e.find(".drts-location-text-viewport"),l=e.find(".drts-location-text-zoom"),c=e.find(".drts-location-text-radius"),g=c.hasClass("drts-location-text-radius-slider"),d=function(){g?c.data("ionRangeSlider").reset():c.val("")};if(s.length){var r={suggest_place:void 0===e.data("suggest-place")||(e.data("suggest-place")||!1),suggest_place_header:e.data("suggest-place-header")||"",suggest_place_footer:e.data("suggest-place-footer")||"",suggest_place_icon:e.data("suggest-place-icon")||"fas fa-map-pin",suggest_place_country:e.data("suggest-place-country")||null,suggest_place_minlength:e.data("suggest-place-minlength")||1,suggest_location:e.data("suggest-location"),suggest_location_header:e.data("suggest-location-header")||"",suggest_location_icon:e.data("suggest-location-icon")||"",suggest_location_url:e.data("suggest-location-url")||null,suggest_location_count:e.data("suggest-location-count")||null,suggest_location_parents:e.data("suggest-location-parents")||!1,geolocation:void 0===e.data("geolocation")||(e.data("geolocation")||!1)},u=e.find(".drts-location-text-term-id"),v=e.find(".drts-location-text-taxonomy"),p=e.find(".drts-clear").css("visibility",0<s.val().length?"visible":"hidden"),a=[];if(r.suggest_location&&r.suggest_location_url){var h={},_=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title","pt"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:r.suggest_location_url}});r.suggest_location_header&&(h.header="<h4>"+r.suggest_location_header+"</h4>"),h.suggestion=function(t){var e=t.title;r.suggest_location_count&&(e+=" ("+(t.count||"0")+")"),r.suggest_location_parents&&t.pt&&(e=t.pt.join(" -> ")+" -> "+e);var a,o=y("<div/>").html(y("<span />").text(e));return t.icon_src?a=y("<img/>").attr("class","drts-icon drts-icon-sm").attr("src",t.icon_src):r.suggest_location_icon&&(a=y("<i/>").attr("class","drts-icon drts-icon-sm "+r.suggest_location_icon)),a&&o.prepend(a),o[0].outerHTML},a.push({name:r.suggest_location,source:function(t,e,a){0<t.length&&_.search(t,e,a)},display:"title",templates:h,limit:e.data("suggest-location-num")||100})}if(r.suggest_place){var f={};r.suggest_place_header&&(f.header=y("<h4/>").text(r.suggest_place_header)[0].outerHTML),r.suggest_place_icon&&(f.suggestion=function(t){var e=y("<div/>");return e.append(y("<i/>").attr("class","drts-icon drts-icon-sm "+r.suggest_place_icon)).append(y("<span/>").text(t.text)),e[0].outerHTML}),r.suggest_place_footer&&(f.footer=y("<div/>").attr("class","tt-footer").css({"text-align":"right",margin:"0 5px 3px"}).html(r.suggest_place_footer)[0].outerHTML),a.push({name:"place",display:"text",templates:f,source:function(t,e,a){t.length<r.suggest_place_minlength||DRTS.Location.api.getSuggestions(t,a)}})}if(r.geolocation&&navigator.geolocation&&("https:"===document.location.protocol||"localhost"===document.location.hostname)){var m=function(){var e=!1;s.addClass("drts-ajax-loading"),navigator.geolocation.getCurrentPosition(function(a){s.removeClass("drts-ajax-loading"),e=o=!0,DRTS.Location.api.reverseGeocode([a.coords.latitude,a.coords.longitude],function(t){s.val(t.address).typeahead("val",t.address),v.val(""),u.val(""),i.val(""),l.val(""),g||c.val(1),p.css("visibility",0<s.val().length?"visible":"hidden");var e=a.coords.latitude+","+a.coords.longitude;e!==n.val()&&(n.val(e),s.trigger("change"))},function(t){DRTS.flash(t.message,"danger")})},function(t){s.removeClass("drts-ajax-loading"),e||DRTS.flash(t.message,"danger"),console.log(t.message+" ("+t.code+")")},{enableHighAccuracy:!0,timeout:5e3})};a.push({name:"geolocate",source:function(t,e){o||e([{content:""}])},display:"content",templates:{suggestion:function(){var t=y("<i/>").attr("class","drts-icon drts-icon-sm fas fa-location-arrow");return y("<div/>").html(y("<span/>").text(e.data("geolocation-text")||"Current location")).prepend(t)[0].outerHTML}}})}else e.addClass("drts-location-no-geolocation");a.length?(s.typeahead({highlight:!0,minLength:0},a),s.on("typeahead:select",function(t,e,a){n.val(""),i.val(""),l.val(""),o=!1,g||d(),a===r.suggest_location?(v.val(r.suggest_location),u.val(e.id)):"place"===a?(v.val(""),u.val(""),e.latlng?n.val(e.latlng[0]+","+e.latlng[1]):DRTS.Location.api.geocode(e.text,function(t){n.val(t[0]+","+t[1])},function(t){console.log(t)})):"geolocate"===a&&m(),p.css("visibility",0<s.val().length?"visible":"hidden")}).on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&(v.val(""),u.val(""),n.val(""),i.val(""),l.val(""),g||d(),p.css("visibility",0<s.val().length?"visible":"hidden")),o=!1}).on("typeahead:open",function(){s.closest(".twitter-typeahead").addClass("twitter-typeahead-open")}).on("typeahead:close",function(){s.closest(".twitter-typeahead").removeClass("twitter-typeahead-open")}),p.click(function(){v.val(""),u.val(""),n.val(""),i.val(""),l.val(""),g||d(),p.css("visibility","hidden"),s.typeahead("val","").focus().trigger("change"),o=!1,s.typeahead("open")})):(s.bind("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&p.css("visibility",0<s.val().length?"visible":"hidden")}),p.click(function(){p.css("visibility","hidden"),s.val("").focus().trigger("change")})),g&&c.on("change",function(){l.val()||i.val("")})}e.on("entity_reset_form_field.sabai",function(){s.length&&(a.length?s.typeahead("val",""):s.val(""),v.val(""),u.val("")),n.val(""),i.val(""),l.val(""),d()})}}}(jQuery);