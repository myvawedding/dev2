"use strict";!function(d){DRTS.Form.field.file=function(e,a,l){var r,i,o,n,t=0;l=d.extend({maxNumFiles:0,maxNumFileExceededError:"",paramName:"drts_form_upload",formData:{},onError:function(e){alert(e.messages[0].msg)},onMaxNumFileExceededError:null,onSuccess:null,uploadUrl:null},l),e&&a&&l.uploadUrl&&(r=d(e)).length&&(i=r.closest(".drts-form-type-file")).length&&(l.onSuccess||(l.onSuccess=function(e){var s=[],r=l.maxNumFiles&&t>=l.maxNumFiles;d.each(e,function(e,r){s.push('<span class="'+DRTS.bsPrefix+"badge "+DRTS.bsPrefix+"badge-secondary "+DRTS.bsPrefix+'ml-2 drts-form-file-uploaded">'+r.name+' <i class="fas fa-times"></i><input name="'+a+'[selected][]" type="hidden" value="'+r.saved_file_name+'" checked="checked" /></span>\n')}),i.find("input[type=file]").prop("disabled",r).parent("."+DRTS.bsPrefix+"btn").after(s).toggleClass(DRTS.bsPrefix+"disabled",r)},i.on("click",".drts-form-file-uploaded > i",function(){d(this).closest(".drts-form-file-uploaded").remove(),--t;var e=l.maxNumFiles&&t>=l.maxNumFiles;i.find("input[type=file]").prop("disabled",e).parent("."+DRTS.bsPrefix+"btn").toggleClass(DRTS.bsPrefix+"disabled",e)}),i.on("hover",".drts-form-file-uploaded > i",function(){d(this).css("cursor","pointer")})),(o=i.find("."+DRTS.bsPrefix+"progress")).length&&((n=o.find("."+DRTS.bsPrefix+"progress-bar")).length||(n=null)),r.fileupload({url:l.uploadUrl,dataType:"json",paramName:l.paramName,formData:l.formData,singleFileUploads:!0,submit:function(e,r){if(l.maxNumFiles&&t+r.files.length>l.maxNumFiles)return l.onMaxNumFileExceededError&&l.onMaxNumFileExceededError(t),!1;n&&(n.attr("aria-valuenow",0).css("width","0%").text("0%"),o.show())},fail:function(e,r){if(n&&o.hide(),l.onError)try{var s=JSON.parse(r.jqXHR.responseText.replace(/<!--[\s\S]*?-->/g,""));l.onError(s)}catch(e){console.log(e.toString())}},done:function(e,r){n&&o.hide(),t+=r.result.length,l.onSuccess&&l.onSuccess(r.result)},progressall:function(e,r){if(n){var s=parseInt(r.loaded/r.total*100,10);n.attr("aria-valuenow",s).css("width",s+"%").text(s+"%")}}}))}}(jQuery);