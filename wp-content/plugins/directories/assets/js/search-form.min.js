"use strict";!function(k){DRTS.Search=DRTS.Search||{},DRTS.Search.keyword=DRTS.Search.keyword||function(t){var p=k(t);if(p.length){var n=p.find(".drts-search-keyword-text");if(n.length){var o,a=p.find(".drts-clear").css("visibility",0<n.val().length?"visible":"hidden"),e=p.closest(".drts-search-form"),i=e.find(".drts-search-keyword-id"),r=e.find(".drts-search-keyword-taxonomy"),y=[],u={suggest_post:!0===p.data("suggest-post"),suggest_post_url:p.data("suggest-post-url")||"",suggest_post_jump:!0===p.data("suggest-post-jump"),suggest_taxonomy:!0===p.data("suggest-taxonomy"),suggest_min_length:p.data("suggest-min-length")||2},m=function(t,e,s){var o,n;return t.icon_src?o=k("<img/>").attr("class","drts-icon drts-icon-sm").attr("src",t.icon_src):(n=t.icon||!!s&&t.parent_icon||e)&&(o=k("<i/>").attr("class","drts-icon drts-icon-sm "+n),t.color&&o.css({"background-color":t.color,color:"#fff"})),o};if(u.suggest_post&&u.suggest_post_url){var d,s=p.data("suggest-post-header")||"",l=p.data("suggest-post-icon")||null,g=p.data("suggest-post-num")||5,c=p.data("suggest-post-wildcard")||"QUERY",h={},f={datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:c,url:u.suggest_post_url},sufficient:g,identify:function(t){return t.id}};p.data("suggest-post-prefetch-url")&&(f.prefetch={url:p.data("suggest-post-prefetch-url")}),d=new Bloodhound(f),s&&(h.header=k("<h4/>").text(s)[0].outerHTML),h.suggestion=(o=l,function(t){var e=k("<div/>").html(k("<span />").text(t.title)),s=m(t,o);return s&&e.prepend(s),e[0].outerHTML}),y.push({name:"post",display:"title",templates:h,source:function(t,e,s){t.length>=u.suggest_min_length&&d.search(t,e,s)}})}if(u.suggest_taxonomy){var v=u.suggest_taxonomy.split(",");v&&v.length&&k.each(v,function(t,e){var n,s=p.data("suggest-taxonomy-"+e+"-url");if(s){var o={},a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title","pt"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:s}}),i=p.data("suggest-taxonomy-"+e+"-header");i&&(o.header=k("<h4/>").text(i)[0].outerHTML);var r=p.data("suggest-taxonomy-"+e+"-icon"),u=p.data("suggest-taxonomy-"+e+"-count"),d=p.data("suggest-taxonomy-"+e+"-parents");o.suggestion=(n=r,function(t){var e,s=t.title,o=m(t,n,!0);return u&&(s=s+" ("+(t.count||"0")+")"),d&&t.pt&&(s=t.pt.join(" -> ")+" -> "+s),e=k("<div/>").html(k("<span>").text(s)),o&&e.prepend(o),e[0].outerHTML}),y.push({name:e,source:function(t,e,s){0<t.length&&a.search(t,e,s)},display:"title",templates:o,limit:p.data("suggest-taxonomy-"+e+"-num")||100})}var l,g=p.data("suggest-taxonomy-top-"+e+"-url");if(g){var c={},h=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:g}});r=p.data("suggest-taxonomy-"+e+"-icon"),u=p.data("suggest-taxonomy-"+e+"-count");c.suggestion=(l=r,function(t){var e,s=t.title,o=m(t,l,!0);return u&&(s=s+" ("+(t.count||"0")+")"),e=k("<div/>").html(k("<span>").text(s)),o&&e.prepend(o),e[0].outerHTML}),y.push({name:"top-"+e,source:function(t,e,s){t.length||e(h.all())},display:"title",templates:c,limit:100})}})}y.length?(n.typeahead({highlight:!0,minLength:u.suggest_taxonomy?0:u.suggest_min_length},y),n.on("typeahead:select",function(t,e,s){var o;"post"!==s?(console.log(s),0===s.indexOf("top-")&&(s=s.substr(4),a.css("visibility",0<n.val().length?"visible":"hidden")),r.val(s)):(o=u.suggest_post_jump,r.val("")),o&&e.url?window.location.href=e.url:(i.val(e.id),n.trigger("change").blur())}).on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&(r.val(""),i.val(""),a.css("visibility",0<n.val().length?"visible":"hidden"))}).on("typeahead:render",function(){n.closest(".twitter-typeahead").addClass("twitter-typeahead-open")}).on("typeahead:close",function(){n.closest(".twitter-typeahead").removeClass("twitter-typeahead-open")}),a.click(function(){n.typeahead("val","").focus(),r.val(""),i.val(""),a.css("visibility","hidden")})):(n.on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&a.css("visibility",0<n.val().length?"visible":"hidden")}),a.click(function(){n.val("").focus(),a.css("visibility","hidden")}))}}}}(jQuery);