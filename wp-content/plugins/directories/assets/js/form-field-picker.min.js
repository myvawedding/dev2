"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},_createClass=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(u){DRTS.Form.field.picker=function(){function l(e,t){var i=this;_classCallCheck(this,l),this.field=u(e),this.items=[],this._allItems=null,this.page=1;var s=DRTS.Form.field.picker.DEFAULTS;this.options=_extends({},s,t,this.field.data());var n=DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+"btn-primary "+DRTS.bsPrefix+"disabled",r=DRTS.bsPrefix+"form-control "+DRTS.bsPrefix+"form-control-sm",a=this.options.searchText||"Search...";this.div=u('<div class="drts-form-picker"><div class="drts-form-picker-pager" style="display:none;"><button class="drts-form-picker-prev '+n+'" value="-1"><i class="fas fa-angle-left"></i></button><span></span><button class="drts-form-picker-next '+n+'" value="1"><i class="fas fa-angle-right"></i></buttondrts-form-picker-pager></div><div class="drts-form-picker-search" style="display:none;"><input type="text" class="'+r+'" placeholder="'+a+'"></input></div><div class="drts-form-picker-items"></div></div>');var o=u('<input type="hidden"></input>').attr("name",this.field.attr("name")||"").val(this.options.current);this.field.addClass("drts-form-picker-trigger").empty().append(o),"BUTTON"===this.field.prop("tagName")?(this.inline=!1,this.field.append("<div></div>").append('<span class="fas fa-caret-down"></span>').on("click",function(e){e.preventDefault(),i.field.sabaiPopover({animation:!1,trigger:"manual",html:!0,content:i.div,container:i.field.closest(".drts"),placement:i.options.placement}).on("shown.bs.popover",function(){i.showItem(o.val()),i._bindEvents()}),u(i.field.data("bs.popover").getTipElement()).addClass("drts-form-picker-popover"),i.field.sabaiPopover("show")})):(this.inline=!0,this.field.append(this.div).addClass(DRTS.bsPrefix+this.options.align),this.showItem(o.val()),this._bindEvents())}return _createClass(l,[{key:"setItems",value:function(e){var t=this;if(this.items=e,!1===this.inline){var i=this.field.find("input").val();if(i){var s=this.items.find(function(e){return t._getItemValue(e).toString()===i});s&&this.field.find("div").html(this._getItemLabel(s))}}}},{key:"showItem",value:function(t){var i=this,e=this.items.findIndex(function(e){return i._getItemValue(e).toString()===t}),s=1<e?Math.ceil((e+1)/this.getItemCountPerPage()):1;this.showPage(s),this.div.find('.drts-form-picker-item[value="'+t+'"]').removeClass(this.options.unselectedClass).addClass(this.options.selectedClass)}},{key:"showPage",value:function(e){this.page=e;var t=this.div.find(".drts-form-picker-items").empty(),i=(e-1)*this.getItemCountPerPage(),s=i,n=this.options.rows,r=this.options.cols;0===this.options.rows&&(n=this.items.length);for(var a=DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm",o=0;o<n;o++){for(var l=u('<div class="drts-row drts-gutter-none"></div>'),d=0;d<r;d++){s=i+o*r+d;var c=u("<button></button>").addClass("drts-form-picker-item "+this.options.unselectedClass+" "+a).css("visibility","hidden");if(s<this.items.length){var f=this._getItemValue(this.items[s]);c.val(f).data("value",f).append(this._renderItem(this.items[s])).css("visibility","visible").attr("title",this._getItemName(this.items[s]))}l.append(u('<div class="drts-col-'+12/r+'"></div>').append(c))}if(t.append(l),s>=this.items.length)break}if(this.options.pager){var h=this.div.find(".drts-form-picker-pager"),p=this._getTotalPages();h.css("display","flex").find(".drts-form-picker-prev").toggleClass(DRTS.bsPrefix+"disabled",e<=1).end().find(".drts-form-picker-next").toggleClass(DRTS.bsPrefix+"disabled",e===p).end().find("> span").text(0<p?this.page+" / "+p:"")}this.options.search&&this.div.find(".drts-form-picker-search").css("display","block"),this._bindEvents()}},{key:"selectItem",value:function(t){var i=this;console.log(t);var e=this.items.findIndex(function(e){return i._getItemValue(e).toString()===t});void 0!==e&&(this.field.find("input").val(t),!1===this.inline&&(console.log(e,this.items[e]),this.field.find("div").html(this._getItemLabel(this.items[e]))),this.field.trigger("change",{item:this.items[e]}))}},{key:"getItemCountPerPage",value:function(){return 0===this.options.rows?this.items.length:this.options.cols*this.options.rows}},{key:"_getTotalPages",value:function(){return Math.ceil(this.items.length/this.getItemCountPerPage())}},{key:"_getItemName",value:function(e){return e.value}},{key:"_getItemValue",value:function(e){return e.value}},{key:"_getItemLabel",value:function(e){return e.label}},{key:"_renderItem",value:function(e){return e.label}},{key:"_bindEvents",value:function(){var i=this;this.div.find(".drts-form-picker-item").off("click").on("click",function(e){e.preventDefault();var t=u(e.currentTarget).val();i.selectItem(t),!1===i.inline?i.field.sabaiPopover("dispose"):i.div.find('.drts-form-picker-item[value="'+t+'"]').removeClass(i.options.unselectedClass).addClass(i.options.selectedClass)}),this.options.pager&&this.div.find(".drts-form-picker-prev, .drts-form-picker-next").off("click").on("click",function(e){e.preventDefault();var t=u(e.currentTarget);t.hasClass(DRTS.bsPrefix+"disabled")||i.showPage(i.page+parseInt(t.val(),10))}),this.options.search&&this.div.find(".drts-form-picker-search input").off("keyup").on("keyup",function(e){i.filterItems(u(e.currentTarget).val()),i.showPage(1)})}},{key:"filterItems",value:function(i){var s=this;if(null===this._allItems&&(this._allItems=this.items),""!==i){var n=[];u.each(this._allItems,function(e,t){s._itemMatches(t,i)&&n.push(t)}),this.items=n}else this.items=this._allItems}},{key:"_itemMatches",value:function(e,t){return-1<e.toLowerCase().indexOf(t)}}]),l}(),DRTS.Form.field.picker.DEFAULTS={deselectable:!1,placement:"bottom",align:"center",cols:4,rows:4,current:"",pager:!0,search:!0,selectedClass:DRTS.bsPrefix+"btn-info",unselectedClass:DRTS.bsPrefix+"btn-outline-secondary"},u(document).on("click","body",function(t){u(".drts-form-picker-trigger").each(function(){var e=u(this);e.is(t.target)||0!==e.has(t.target).length||0!==u("."+DRTS.bsPrefix+"popover").has(t.target).length||e.sabaiPopover("dispose")})})}(jQuery);