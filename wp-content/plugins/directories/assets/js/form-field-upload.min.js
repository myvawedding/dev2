"use strict";!function(d){DRTS.Form.field.upload=function(n){n=d.extend({selector:"",maxNumFiles:0,maxNumFileExceededError:"",inputName:"files",sortable:!0,formData:{}},n);var e=d(n.selector);if(e.length){var r=e.closest(".drts-form-upload-container"),a=r.find("."+DRTS.bsPrefix+"progress"),l=a.find("."+DRTS.bsPrefix+"progress-bar"),o=0;e.fileupload({url:n.url,dataType:"json",paramName:"drts_form_upload",formData:n.formData,singleFileUploads:!0,submit:function(e,t){if(n.maxNumFiles&&o+t.files.length>n.maxNumFiles)return n.maxNumFileExceededError&&alert(n.maxNumFileExceededError),!1;l.attr("aria-valuenow",0).css("width","0%").text("0%"),a.show()},fail:function(e,t){a.hide(),DRTS.flash(t.result.error,"danger")},done:function(e,t){if(t.result.error)return a.hide(),void DRTS.flash(t.result.error,"danger");o+=t.result.files.length;var i=r.find(".drts-form-upload-current").find("table");DRTS.ajaxLoader(null,!1,r),d.each(t.result.files,function(e,t){var r=d('<tr class="drts-form-upload-row"/>'),a=d('<input type="checkbox" checked="checked">').attr("name",n.inputName+"[current]["+t.id+"][check][]").val(t.id),l=d('<input class="'+DRTS.bsPrefix+'form-control" type="text" checked="checked">').attr("name",n.inputName+"[current]["+t.id+"][name]").val(t.title),o=d('<a target="_blank"/>').attr("href",t.url).html('<i class="fas fa-lg fa-download"></i>');d("<td/>").html(a).appendTo(r),t.thumbnail?d("<td/>").html(d("<img/>").attr("src",t.thumbnail)).appendTo(r):d("<td/>").html(d("<i/>").attr("class",t.icon)).appendTo(r),d("<td/>").html(l).appendTo(r),d("<td/>").text(t.size_hr).appendTo(r),d("<td/>").html(o).appendTo(r),i.has(".drts-form-upload-row").length?d(r).appendTo(i.find("tbody")).effect("highlight",{},2e3):i.find("tbody").html(r).effect("highlight",{},2e3)}),DRTS.ajaxLoader(null,!0,r),a.hide(),n.sortable&&DRTS.init(i.find("tbody").sortable("destroy").sortable({containment:"parent",axis:"y"}).parent())},progressall:function(e,t){var r=parseInt(t.loaded/t.total*100,10);l.attr("aria-valuenow",r).css("width",r+"%").text(r+"%")}}),e.closest("form").submit(function(){if(n.maxNumFiles&&r.find('.drts-form-upload-current tbody input[type="checkbox"]:checked').length>n.maxNumFiles)return n.maxNumFileExceededError&&alert(n.maxNumFileExceededError),!1}),n.sortable&&r.find(".drts-form-upload-current tbody").sortable({containment:"parent",axis:"y"})}}}(jQuery);